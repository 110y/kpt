/**
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/// <reference types="node" />

import fs = require('fs');

declare namespace re {
    interface Entry extends fs.Stats {
        path: string;
        depth: number;
    }

    type FilterFunction = (stat: Entry) => boolean;
    type Callback<T> = (err: NodeJS.ErrnoException, result: T) => void;
    type CallbackString = Callback<string[]>;
    type CallbackEntry = Callback<Entry[]>;

    interface FileSystem {
        readdir?: (path: string, callback: Callback<string[]>) => void;
        lstat?: (path: string, callback: Callback<fs.Stats>) => void;
        stat?: (path: string, callback: Callback<fs.Stats>) => void;
    }

    interface Options {
        filter?: string | RegExp | FilterFunction;
        deep?: boolean | number | RegExp | FilterFunction;
        sep?: string;
        basePath?: string;
        fs?: FileSystem;
    }

    function stat(root: string, options?: Options): Promise<Entry[]>;
    function stat(root: string, callback: CallbackEntry): void;
    function stat(root: string, options: Options, callback: CallbackEntry): void;

    function async(root: string, options?: Options): Promise<string[]>;
    function async(root: string, callback: CallbackString): void;
    function async(root: string, options: Options, callback: CallbackString): void;

    function readdirAsyncStat(root: string, options?: Options): Promise<Entry[]>;
    function readdirAsyncStat(root: string, callback: CallbackEntry): void;
    function readdirAsyncStat(root: string, options: Options, callback: CallbackEntry): void;

    namespace async {
        function stat(root: string, options?: Options): Promise<Entry[]>;
        function stat(root: string, callback: CallbackEntry): void;
        function stat(root: string, options: Options, callback: CallbackEntry): void;
    }

    function stream(root: string, options?: Options): NodeJS.ReadableStream;
    function readdirStreamStat(root: string, options?: Options): NodeJS.ReadableStream;

    namespace stream {
        function stat(root: string, options?: Options): NodeJS.ReadableStream;
    }

    function sync(root: string, options?: Options): string[];
    function readdirSyncStat(root: string, options?: Options): Entry[];

    namespace sync {
        function stat(root: string, options?: Options): Entry[];
    }
}

declare function re(root: string, options?: re.Options): Promise<string[]>;
declare function re(root: string, callback: re.CallbackString): void;
declare function re(root: string, options: re.Options, callback: re.CallbackString): void;

export = re;
